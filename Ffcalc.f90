!*==FFCALC_001.f90  processed by SPAG 6.11Dc at 13:14 on 17 Sep 2001
!CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
!
      FUNCTION FFCALC_001(IR)
      INCLUDE 'SGinc\FFCALCTOP.inc'
      INCLUDE 'SGinc\FFCALC_001.f90'
      END FUNCTION FFCALC_001
!*==FFCALC_002.f90  processed by SPAG 6.11Dc at 13:14 on 17 Sep 2001
!
      FUNCTION FFCALC_002(IR)
      INCLUDE 'SGinc\FFCALCTOP.inc'
      INCLUDE 'SGinc\FFCALC_002.f90'
      END FUNCTION FFCALC_002
!*==FFCALC_039.f90  processed by SPAG 6.11Dc at 13:14 on 17 Sep 2001
!
      FUNCTION FFCALC_039(IR)
      INCLUDE 'SGinc\FFCALCTOP.inc'
      INCLUDE 'SGinc\FFCALC_039.f90'
      END FUNCTION FFCALC_039
!*==FFCALC_040.f90  processed by SPAG 6.11Dc at 13:14 on 17 Sep 2001
!
      FUNCTION FFCALC_040(IR)
      INCLUDE 'SGinc\FFCALCTOP.inc'
      INCLUDE 'SGinc\FFCALC_040.f90'
      END FUNCTION FFCALC_040
!*==FFCALC_044.f90  processed by SPAG 6.11Dc at 13:14 on 17 Sep 2001
!
      FUNCTION FFCALC_044(IR)
      INCLUDE 'SGinc\FFCALCTOP.inc'
      INCLUDE 'SGinc\FFCALC_044.f90'
      END FUNCTION FFCALC_044
!*==FFCALC_050.f90  processed by SPAG 6.11Dc at 13:14 on 17 Sep 2001
!
      FUNCTION FFCALC_050(IR)
      INCLUDE 'SGinc\FFCALCTOP.inc'
      INCLUDE 'SGinc\FFCALC_050.f90'
      END FUNCTION FFCALC_050
!*==FFCALC_052.f90  processed by SPAG 6.11Dc at 13:14 on 17 Sep 2001
!
      FUNCTION FFCALC_052(IR)
      INCLUDE 'SGinc\FFCALCTOP.inc'
      INCLUDE 'SGinc\FFCALC_052.f90'
      END FUNCTION FFCALC_052
!*==FFCALC_057.f90  processed by SPAG 6.11Dc at 13:14 on 17 Sep 2001
!
      FUNCTION FFCALC_057(IR)
      INCLUDE 'SGinc\FFCALCTOP.inc'
      INCLUDE 'SGinc\FFCALC_057.f90'
      END FUNCTION FFCALC_057
!*==FFCALC_058.f90  processed by SPAG 6.11Dc at 13:14 on 17 Sep 2001
!
      FUNCTION FFCALC_058(IR)
      INCLUDE 'SGinc\FFCALCTOP.inc'
      INCLUDE 'SGinc\FFCALC_058.f90'
      END FUNCTION FFCALC_058
!*==FFCALC_061.f90  processed by SPAG 6.11Dc at 13:14 on 17 Sep 2001
!
      FUNCTION FFCALC_061(IR)
      INCLUDE 'SGinc\FFCALCTOP.inc'
      INCLUDE 'SGinc\FFCALC_061.f90'
      END FUNCTION FFCALC_061
!*==FFCALC_064.f90  processed by SPAG 6.11Dc at 13:14 on 17 Sep 2001
!
      FUNCTION FFCALC_064(IR)
      INCLUDE 'SGinc\FFCALCTOP.inc'
      INCLUDE 'SGinc\FFCALC_064.f90'
      END FUNCTION FFCALC_064
!*==FFCALC_065.f90  processed by SPAG 6.11Dc at 13:14 on 17 Sep 2001
!
      FUNCTION FFCALC_065(IR)
      INCLUDE 'SGinc\FFCALCTOP.inc'
      INCLUDE 'SGinc\FFCALC_065.f90'
      END FUNCTION FFCALC_065
!*==FFCALC_066.f90  processed by SPAG 6.11Dc at 13:14 on 17 Sep 2001
!
      FUNCTION FFCALC_066(IR)
      INCLUDE 'SGinc\FFCALCTOP.inc'
      INCLUDE 'SGinc\FFCALC_066.f90'
      END FUNCTION FFCALC_066
!*==FFCALC_067.f90  processed by SPAG 6.11Dc at 13:14 on 17 Sep 2001
!
      FUNCTION FFCALC_067(IR)
      INCLUDE 'SGinc\FFCALCTOP.inc'
      INCLUDE 'SGinc\FFCALC_067.f90'
      END FUNCTION FFCALC_067
!*==FFCALC_069.f90  processed by SPAG 6.11Dc at 13:14 on 17 Sep 2001
!
      FUNCTION FFCALC_069(IR)
      INCLUDE 'SGinc\FFCALCTOP.inc'
      INCLUDE 'SGinc\FFCALC_069.f90'
      END FUNCTION FFCALC_069
!*==FFCALC_112.f90  processed by SPAG 6.11Dc at 13:14 on 17 Sep 2001
!
      FUNCTION FFCALC_112(IR)
      INCLUDE 'SGinc\FFCALCTOP.inc'
      INCLUDE 'SGinc\FFCALC_112.f90'
      END FUNCTION FFCALC_112
!*==FFCALC_115.f90  processed by SPAG 6.11Dc at 13:14 on 17 Sep 2001
!
      FUNCTION FFCALC_115(IR)
      INCLUDE 'SGinc\FFCALCTOP.inc'
      INCLUDE 'SGinc\FFCALC_115.f90'
      END FUNCTION FFCALC_115
!*==FFCALC_116.f90  processed by SPAG 6.11Dc at 13:14 on 17 Sep 2001
!
      FUNCTION FFCALC_116(IR)
      INCLUDE 'SGinc\FFCALCTOP.inc'
      INCLUDE 'SGinc\FFCALC_116.f90'
      END FUNCTION FFCALC_116
!*==FFCALC_143.f90  processed by SPAG 6.11Dc at 13:14 on 17 Sep 2001
!
      FUNCTION FFCALC_143(IR)
      INCLUDE 'SGinc\FFCALCTOP.inc'
      INCLUDE 'SGinc\FFCALC_143.f90'
      END FUNCTION FFCALC_143
!*==FFCALC_164.f90  processed by SPAG 6.11Dc at 13:14 on 17 Sep 2001
!
      FUNCTION FFCALC_164(IR)
      INCLUDE 'SGinc\FFCALCTOP.inc'
      INCLUDE 'SGinc\FFCALC_164.f90'
      END FUNCTION FFCALC_164
!*==FFCALC_176.f90  processed by SPAG 6.11Dc at 13:14 on 17 Sep 2001
!
      FUNCTION FFCALC_176(IR)
      INCLUDE 'SGinc\FFCALCTOP.inc'
      INCLUDE 'SGinc\FFCALC_176.f90'
      END FUNCTION FFCALC_176
!*==FFCALC_212.f90  processed by SPAG 6.11Dc at 13:14 on 17 Sep 2001
!
      FUNCTION FFCALC_212(IR)
      INCLUDE 'SGinc\FFCALCTOP.inc'
      INCLUDE 'SGinc\FFCALC_212.f90'
      END FUNCTION FFCALC_212
!*==FFCALC_266.f90  processed by SPAG 6.11Dc at 13:14 on 17 Sep 2001
!
      FUNCTION FFCALC_266(IR)
      INCLUDE 'SGinc\FFCALCTOP.inc'
      INCLUDE 'SGinc\FFCALC_266.f90'
      END FUNCTION FFCALC_266
!*==FFCALC_269.f90  processed by SPAG 6.11Dc at 13:14 on 17 Sep 2001
!
      FUNCTION FFCALC_269(IR)
      INCLUDE 'SGinc\FFCALCTOP.inc'
      INCLUDE 'SGinc\FFCALC_269.f90'
      END FUNCTION FFCALC_269
!*==FFCALC_284.f90  processed by SPAG 6.11Dc at 13:14 on 17 Sep 2001
!
      FUNCTION FFCALC_284(IR)
      INCLUDE 'SGinc\FFCALCTOP.inc'
      INCLUDE 'SGinc\FFCALC_284.f90'
      END FUNCTION FFCALC_284
!*==FFCALC_290.f90  processed by SPAG 6.11Dc at 13:14 on 17 Sep 2001
!
      FUNCTION FFCALC_290(IR)
      INCLUDE 'SGinc\FFCALCTOP.inc'
      INCLUDE 'SGinc\FFCALC_290.f90'
      END FUNCTION FFCALC_290
!*==FFCALC_292.f90  processed by SPAG 6.11Dc at 13:14 on 17 Sep 2001
!
      FUNCTION FFCALC_292(IR)
      INCLUDE 'SGinc\FFCALCTOP.inc'
      INCLUDE 'SGinc\FFCALC_292.f90'
      END FUNCTION FFCALC_292
!*==FFCALC_298.f90  processed by SPAG 6.11Dc at 13:14 on 17 Sep 2001
!
      FUNCTION FFCALC_298(IR)
      INCLUDE 'SGinc\FFCALCTOP.inc'
      INCLUDE 'SGinc\FFCALC_298.f90'
      END FUNCTION FFCALC_298
!*==FFCALC_304.f90  processed by SPAG 6.11Dc at 13:14 on 17 Sep 2001
!
      FUNCTION FFCALC_304(IR)
      INCLUDE 'SGinc\FFCALCTOP.inc'
      INCLUDE 'SGinc\FFCALC_304.f90'
      END FUNCTION FFCALC_304
!*==FFCALC_356.f90  processed by SPAG 6.11Dc at 13:14 on 17 Sep 2001
!
      FUNCTION FFCALC_356(IR)
      INCLUDE 'SGinc\FFCALCTOP.inc'
      INCLUDE 'SGinc\FFCALC_356.f90'
      END FUNCTION FFCALC_356
!*==FFCALC_365.f90  processed by SPAG 6.11Dc at 13:14 on 17 Sep 2001
!
      FUNCTION FFCALC_365(IR)
      INCLUDE 'SGinc\FFCALCTOP.inc'
      INCLUDE 'SGinc\FFCALC_365.f90'
      END FUNCTION FFCALC_365
!*==FFCALC_369.f90  processed by SPAG 6.11Dc at 13:14 on 17 Sep 2001
!
      FUNCTION FFCALC_369(IR)
      INCLUDE 'SGinc\FFCALCTOP.inc'
      INCLUDE 'SGinc\FFCALC_369.f90'
      END FUNCTION FFCALC_369
!*==FFCALC_430.f90  processed by SPAG 6.11Dc at 13:14 on 17 Sep 2001
!
      FUNCTION FFCALC_430(IR)
      INCLUDE 'SGinc\FFCALCTOP.inc'
      INCLUDE 'SGinc\FFCALC_430.f90'
      END FUNCTION FFCALC_430
!*==FFCALC_431.f90  processed by SPAG 6.11Dc at 13:14 on 17 Sep 2001
!
      FUNCTION FFCALC_431(IR)
      INCLUDE 'SGinc\FFCALCTOP.inc'
      INCLUDE 'SGinc\FFCALC_431.f90'
      END FUNCTION FFCALC_431
!*==FFCALC_432.f90  processed by SPAG 6.11Dc at 13:14 on 17 Sep 2001
!
      FUNCTION FFCALC_432(IR)
      INCLUDE 'SGinc\FFCALCTOP.inc'
      INCLUDE 'SGinc\FFCALC_432.f90'
      END FUNCTION FFCALC_432
!*==FFCALC_433.f90  processed by SPAG 6.11Dc at 13:14 on 17 Sep 2001
!
      FUNCTION FFCALC_433(IR)
      INCLUDE 'SGinc\FFCALCTOP.inc'
      INCLUDE 'SGinc\FFCALC_433.f90'
      END FUNCTION FFCALC_433
!*==FFCALC_434.f90  processed by SPAG 6.11Dc at 13:14 on 17 Sep 2001
!
      FUNCTION FFCALC_434(IR)
      INCLUDE 'SGinc\FFCALCTOP.inc'
      INCLUDE 'SGinc\FFCALC_434.f90'
      END FUNCTION FFCALC_434
!*==FFCALC_435.f90  processed by SPAG 6.11Dc at 13:14 on 17 Sep 2001
!
      FUNCTION FFCALC_435(IR)
      INCLUDE 'SGinc\FFCALCTOP.inc'
      INCLUDE 'SGinc\FFCALC_435.f90'
      END FUNCTION FFCALC_435
!*==FFCALC_449.f90  processed by SPAG 6.11Dc at 13:14 on 17 Sep 2001
!
      FUNCTION FFCALC_449(IR)
      INCLUDE 'SGinc\FFCALCTOP.inc'
      INCLUDE 'SGinc\FFCALC_449.f90'
      END FUNCTION FFCALC_449
!*==FFCALC_451.f90  processed by SPAG 6.11Dc at 13:14 on 17 Sep 2001
!
      FUNCTION FFCALC_451(IR)
      INCLUDE 'SGinc\FFCALCTOP.inc'
      INCLUDE 'SGinc\FFCALC_451.f90'
      END FUNCTION FFCALC_451
!*==FFCALC_462.f90  processed by SPAG 6.11Dc at 13:14 on 17 Sep 2001
!
      FUNCTION FFCALC_462(IR)
      INCLUDE 'SGinc\FFCALCTOP.inc'
      INCLUDE 'SGinc\FFCALC_462.f90'
      END FUNCTION FFCALC_462
!*==FFCALC_468.f90  processed by SPAG 6.11Dc at 13:14 on 17 Sep 2001
!
      FUNCTION FFCALC_468(IR)
      INCLUDE 'SGinc\FFCALCTOP.inc'
      INCLUDE 'SGinc\FFCALC_468.f90'
      END FUNCTION FFCALC_468
!*==FFCALC_469.f90  processed by SPAG 6.11Dc at 13:14 on 17 Sep 2001
!
      FUNCTION FFCALC_469(IR)
      INCLUDE 'SGinc\FFCALCTOP.inc'
      INCLUDE 'SGinc\FFCALC_469.f90'
      END FUNCTION FFCALC_469
!*==FFCALC_471.f90  processed by SPAG 6.11Dc at 13:14 on 17 Sep 2001
!
      FUNCTION FFCALC_471(IR)
      INCLUDE 'SGinc\FFCALCTOP.inc'
      INCLUDE 'SGinc\FFCALC_471.f90'
      END FUNCTION FFCALC_471
!*==FFCALC_481.f90  processed by SPAG 6.11Dc at 13:14 on 17 Sep 2001
!
      FUNCTION FFCALC_481(IR)
      INCLUDE 'SGinc\FFCALCTOP.inc'
      INCLUDE 'SGinc\FFCALC_481.f90'
      END FUNCTION FFCALC_481
!*==FFCALC_483.f90  processed by SPAG 6.11Dc at 13:14 on 17 Sep 2001
!
      FUNCTION FFCALC_483(IR)
      INCLUDE 'SGinc\FFCALCTOP.inc'
      INCLUDE 'SGinc\FFCALC_483.f90'
      END FUNCTION FFCALC_483
!*==FFCALC_485.f90  processed by SPAG 6.11Dc at 13:14 on 17 Sep 2001
!
      FUNCTION FFCALC_485(IR)
      INCLUDE 'SGinc\FFCALCTOP.inc'
      INCLUDE 'SGinc\FFCALC_485.f90'
      END FUNCTION FFCALC_485
!*==FFCALC_DEFAULT.f90  processed by SPAG 6.11Dc at 13:14 on 17 Sep 2001
!
!
      FUNCTION FFCALC_DEFAULT(IR)

      INCLUDE 'SGinc\FFCALCTOP.inc'
      COMMON /CONSTA/ PI, RAD, DEG, TWOPI, FOURPI, PIBY2, ALOG2, SQL2X8, VALMUB
      COMMON /NSYM  / NOP, NCENT, NOPC, NLAT, NGEN, CENTRC, KOM13
      LOGICAL CENTRC
      COMMON /SYMDA / SYM(3,3,24), TRANS(3,24), ALAT(3,4), ORIGIN(3), KOM26
      COMMON /symsto/ sctrh(24,10000), rhsto(3,24,10000)
      PARAMETER (NAC=256,NBC=100*NAC,FARCOS=256.)
      COMMON /COSARS/ COSAR0(-NBC:NBC), COSAR1(-NBC:NBC), COSAR2(-NBC:NBC)
      COMMON /SINARS/ SINAR0(-NBC:NBC), SINAR1(-NBC:NBC), SINAR2(-NBC:NBC)
!
      AFCALC = 0.0
! Firstly if we are centric then calculate only cosine terms
      IF (CENTRC) THEN
        IF (LOG_HYDROGENS) THEN
          DO N = 1, NATOM
            SUM = 0.
! SUM OVER SYMMETRY EQUIVALENTS:
            DO I = 1, NOPC
! V is 2pi*(h*x+t)
              V = (X(1,N)*RHSTO(1,I,IR)+X(2,N)*RHSTO(2,I,IR)+X(3,N)*RHSTO(3,I,IR)+SCTRH(I,IR))*FARCOS
              IV = V
              PV = V - FLOAT(IV)
              SUM = SUM + COSAR0(IV) + PV*(COSAR1(IV)+PV*COSAR2(IV))
            ENDDO
            AFCALC = AFCALC + SUM*FOB(N,IR)
          ENDDO
        ELSE
          DO NS = 1, NSATOM
            N = ISATOM(NS)
            SUM = 0.0
! SUM OVER SYMMETRY EQUIVALENTS:
            DO I = 1, NOPC
              V = (X(1,N)*RHSTO(1,I,IR)+X(2,N)*RHSTO(2,I,IR)+X(3,N)*RHSTO(3,I,IR)+SCTRH(I,IR))*FARCOS
              IV = V
              PV = V - FLOAT(IV)
              SUM = SUM + COSAR0(IV) + PV*(COSAR1(IV)+PV*COSAR2(IV))
            ENDDO
            AFCALC = AFCALC + SUM*FOB(N,IR)
          ENDDO
        ENDIF
        FFCALC_DEFAULT = AFCALC*AFCALC
      ELSE
! Deal with the non-centric case
        BFCALC = 0.
        IF (LOG_HYDROGENS) THEN
          DO N = 1, NATOM
            SUMA = 0.0
            SUMB = 0.0
! SUM OVER SYMMETRY EQUIVALENTS:
            DO I = 1, NOPC
! V is 2pi*(h*x+t)
              V = (X(1,N)*RHSTO(1,I,IR)+X(2,N)*RHSTO(2,I,IR)+X(3,N)*RHSTO(3,I,IR)+SCTRH(I,IR))*FARCOS
              IV = V
              PV = V - FLOAT(IV)
              SUMA = SUMA + COSAR0(IV) + PV*(COSAR1(IV)+PV*COSAR2(IV))
              SUMB = SUMB + SINAR0(IV) + PV*(SINAR1(IV)+PV*SINAR2(IV))
            ENDDO
            AFCALC = AFCALC + SUMA*FOB(N,IR)
            BFCALC = BFCALC + SUMB*FOB(N,IR)
          ENDDO
        ELSE
          DO NS = 1, NSATOM
            N = ISATOM(NS)
            SUMA = 0.0
            SUMB = 0.0
! SUM OVER SYMMETRY EQUIVALENTS:
            DO I = 1, NOPC
              V = (X(1,N)*RHSTO(1,I,IR)+X(2,N)*RHSTO(2,I,IR)+X(3,N)*RHSTO(3,I,IR)+SCTRH(I,IR))*FARCOS
              IV = V
              PV = V - FLOAT(IV)
              SUMA = SUMA + COSAR0(IV) + PV*(COSAR1(IV)+PV*COSAR2(IV))
              SUMB = SUMB + SINAR0(IV) + PV*(SINAR1(IV)+PV*SINAR2(IV))
            ENDDO
            AFCALC = AFCALC + SUMA*FOB(N,IR)
            BFCALC = BFCALC + SUMB*FOB(N,IR)
          ENDDO
        ENDIF
        FFCALC_DEFAULT = AFCALC*AFCALC + BFCALC*BFCALC
      ENDIF
      RETURN
      END FUNCTION FFCALC_DEFAULT
!*==CALCOSARX.f90  processed by SPAG 6.11Dc at 13:14 on 17 Sep 2001
!
      SUBROUTINE CALCOSARX
      PARAMETER (NAC=256,NBC=100*NAC,FARCOS=256.)
      COMMON /COSARS/ COSAR0(-NBC:NBC), COSAR1(-NBC:NBC), COSAR2(-NBC:NBC)
      COMMON /SINARS/ SINAR0(-NBC:NBC), SINAR1(-NBC:NBC), SINAR2(-NBC:NBC)

      TWOPI = 8.*ATAN(1.)
      AMUL = TWOPI/FARCOS
      DO I = -NBC, NBC
        X = AMUL*FLOAT(I)
        XP = AMUL*FLOAT(I+1)
        XM = AMUL*FLOAT(I-1)
        COSAR0(I) = COS(X)
        COSAR1(I) = 0.5*(COS(XP)-COS(XM))
        COSAR2(I) = 0.5*(COS(XP)+COS(XM)-2.*COSAR0(I))
        SINAR0(I) = SIN(X)
        SINAR1(I) = 0.5*(SIN(XP)-SIN(XM))
        SINAR2(I) = 0.5*(SIN(XP)+SIN(XM)-2.*SINAR0(I))
      ENDDO

      END SUBROUTINE CALCOSARX
