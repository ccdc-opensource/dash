<project>
    <shortName>DASH</shortName>
    <fullName>DASH</fullName>
    <version>3.2</version>
    <licenseFile>Licence.txt</licenseFile>
    <leftImage>../../cppbuilds_shared/installer/images/EFEMUX01_163x314.png</leftImage>
    <logoImage>../../cppbuilds_shared/installer/images/ccdc_logo_48x48.png</logoImage>
    <splashImage>../../cppbuilds_shared/installer/images/ccdc_logo_350x82.png</splashImage>
    <preBuildActionList>
        <copyFile>
            <destination>${build_project_directory}/installer_generated.lng</destination>
            <origin>${build_project_directory}/../../cppbuilds_shared/installer/general_en.lng</origin>
        </copyFile>
        <readFile>
            <name>custom_messages</name>
            <path>${build_project_directory}/${product_shortname}_en.lng</path>
        </readFile>
        <addTextToFile>
            <file>${build_project_directory}/installer_generated.lng</file>
            <text>${custom_messages}</text>
        </addTextToFile>
    </preBuildActionList>
    <postBuildActionList>
        <deleteFile>
            <path>${build_project_directory}/installer_generated.lng</path>
        </deleteFile>
        <runProgram>
            <abortOnError>0</abortOnError>
            <explanation>Running signtool</explanation>
            <program>C:\Program Files\Microsoft Visual Studio 8\SDK\v2.0\Bin\signtool.exe</program>
            <programArguments>sign /f X:\bardwell\digitalid\newdigitalid.pfx /p ccdcsign /d ${product_shortname} /du http://www.ccdc.cam.ac.uk /t http://timestamp.verisign.com/scripts/timstamp.dll ${installerfilename}</programArguments>
            <workingDirectory>${project.outputDirectory}</workingDirectory>
            <ruleList>
                <platformTest>
                    <type>windows</type>
                </platformTest>
            </ruleList>
        </runProgram>
    </postBuildActionList>
    <preInstallationActionList>
        <registryGet>
            <abortOnError>0</abortOnError>
            <key>HKEY_LOCAL_MACHINE\SOFTWARE\ccdc</key>
            <name>DASHLatestVersion</name>
            <show>0</show>
            <showMessageOnError>0</showMessageOnError>
            <variable>dash_latest</variable>
        </registryGet>
    </preInstallationActionList>
    <postInstallationActionList>
        <registrySet>
            <abortOnError>0</abortOnError>
            <key>HKEY_LOCAL_MACHINE\SOFTWARE\ccdc</key>
            <name>DASHLatestVersion</name>
            <show>0</show>
            <showMessageOnError>0</showMessageOnError>
            <type>REG_SZ</type>
            <value>${product_version}</value>
        </registrySet>
        <registrySet>
            <abortOnError>0</abortOnError>
            <key>HKEY_LOCAL_MACHINE\SOFTWARE\ccdc\DASH\${product_version}</key>
            <name>InstallDir</name>
            <show>0</show>
            <showMessageOnError>0</showMessageOnError>
            <type>REG_SZ</type>
            <value>${installdir}</value>
        </registrySet>
        <registrySet>
            <abortOnError>0</abortOnError>
            <key>HKEY_CURRENT_USER\Software\CCDC</key>
            <name>DASHLatestVersion</name>
            <show>0</show>
            <showMessageOnError>0</showMessageOnError>
            <type>REG_SZ</type>
            <value>${product_version}</value>
        </registrySet>
        <registrySet>
            <abortOnError>0</abortOnError>
            <key>HKEY_CURRENT_USER\SOFTWARE\ccdc\DASH\${product_version}</key>
            <name>InstallDir</name>
            <show>0</show>
            <showMessageOnError>0</showMessageOnError>
            <type>REG_SZ</type>
            <value>${installdir}</value>
        </registrySet>
        <writeFile>
            <encoding>ascii</encoding>
            <path>${installdir}\Release-Notes.txt</path>
            <show>0</show>
            <text>DASH 3.2 Release Notes
======================

We are pleased to release DASH 3.2. This version of the program includes 6 
major new features and several minor changes, all summarised below.

Major New Features
==================

1. Mogul Distribution Biasing (MDB)

MDB is a technique for biasing the search space using torsion distributions. 
Unlike the previous method for using Mogul in searching, MDB can be used as a
'black box'; the user can ask to bias searching to regions suggested by torsion
angle distributions. The algorithm is such that distributions with little 
information content do not lead to spurious biasing.  Access to the CSD System
is required for this feature.

2. Aggressive Early Termination

The program can now be set in a mode where it will search for a local 
optimisation to a likely minimum more quickly than in previous DASH versions.

3. Automatic Peak Picking for Indexing

There is an option that allows for auto-selection of peaks in a pattern which
makes selection easier for about 80% of patterns encountered

4. Tethering

Tethers can be applied to atoms during simulated annealing. A bond in a ring 
can be broken to allow the conformation to be explored whilst retaining the 
correct distance restraint with a ring-closing tether.  Atoms from different 
Z-matrices can be tethered, allowing the separation between molecular species
or ions to be restrained.

5. Increased Pattern Data Point Support

The number of pattern data points supported has been increased to 30,000 from
15,000 to allow for ultra-fine 2-theta width pattern measurements

6. Increased Reflection Limit

The Pawley fitting reflection limit has been increased to 1,000 reflections 
from 600

Minor Changes and Bug Fixes
===========================


1. It is now possible to input cell data directly from an ins or cif
2. It is now possible to read batch files back in to DASH
3. Z-matrix generation now treats linear torsions as rigid
4. DASH-TOPAS preferred orientation option in TOPAS inp file is can now be 
   activated
5. Overwriting of .inp files for TOPAS: .inp files are now backed up at each
   step
6. DASH now saves a temporary output file during simulated annealing so if a
   power-cut interrupts a run, completed solutions can still be accessed.
7. In Indexing Step 2: Triclinic is now selected by default
8. Modal torsion angle selection no longer selects the wrong torsion on occasion
9. Reaching a negative temperature during the SA causes run termination 


Future Support
==============

Please note that DASH 3.2 will be the last version of DASH supported on Windows 2000</text>
        </writeFile>
    </postInstallationActionList>
    <enableRollback>1</enableRollback>
    <enableTimestamp>1</enableTimestamp>
    <outputDirectory>${env(DISTRIBUTION_DIRECTORY)}/dash</outputDirectory>
    <saveRelativePaths>1</saveRelativePaths>
    <startMenuGroupName>CCDC/${product_fullname} ${product_version}</startMenuGroupName>
    <vendor>CCDC</vendor>
    <componentList>
        <component>
            <name>default</name>
            <description>Default Component</description>
            <canBeEdited>1</canBeEdited>
            <selected>1</selected>
            <show>1</show>
            <desktopShortcutList>
                <shortcut>
                    <comment>Launch ${product_fullname} ${product_version}</comment>
                    <exec></exec>
                    <icon></icon>
                    <name>${product_fullname} ${product_version}</name>
                    <path></path>
                    <platforms>all</platforms>
                    <runInTerminal>0</runInTerminal>
                    <windowsExec>${installdir}/dash.exe</windowsExec>
                    <windowsExecArgs></windowsExecArgs>
                    <windowsIcon>${installdir}/icons/dash.ico</windowsIcon>
                    <windowsPath>${installdir}</windowsPath>
                </shortcut>
            </desktopShortcutList>
            <folderList>
                <folder>
                    <description>Program Files</description>
                    <destination>${installdir}</destination>
                    <name>programfiles</name>
                    <platforms>all</platforms>
                    <shortcutList>
                        <shortcut>
                            <comment>Uninstall</comment>
                            <exec>${installdir}/${uninstallerName}</exec>
                            <icon></icon>
                            <name>Uninstall ${product_fullname}</name>
                            <path>${installdir}</path>
                            <platforms>all</platforms>
                            <runInTerminal>0</runInTerminal>
                            <windowsExec>${installdir}/${uninstallerName}.exe</windowsExec>
                            <windowsExecArgs></windowsExecArgs>
                            <windowsIcon></windowsIcon>
                            <windowsPath>${installdir}</windowsPath>
                        </shortcut>
                    </shortcutList>
                </folder>
                <folder>
                    <description>Program Files</description>
                    <destination>${installdir}</destination>
                    <name>programfileslinux</name>
                    <platforms>linux</platforms>
                </folder>
                <folder>
                    <description>Program Files</description>
                    <destination>${installdir}</destination>
                    <name>programfileswindows</name>
                    <platforms>windows</platforms>
                    <distributionFileList>
                        <distributionDirectory allowWildcards="1">
                            <origin>${env(DISTRIBUTION_DIRECTORY)}/dash/dash_latest/*</origin>
                        </distributionDirectory>
                    </distributionFileList>
                </folder>
                <folder>
                    <description>Program Files</description>
                    <destination>${installdir}</destination>
                    <name>programfilesosx</name>
                    <platforms>osx</platforms>
                </folder>
            </folderList>
            <startMenuShortcutList>
                <startMenuShortcut>
                    <comment>Uninstall ${product_fullname}</comment>
                    <name>Uninstall ${product_fullname}</name>
                    <runInTerminal>0</runInTerminal>
                    <windowsExec>${installdir}/${uninstallerName}.exe</windowsExec>
                    <windowsExecArgs></windowsExecArgs>
                    <windowsIcon></windowsIcon>
                    <windowsPath>${installdir}/</windowsPath>
                </startMenuShortcut>
                <startMenuShortcut>
                    <comment>${product_fullname} ${product_version}</comment>
                    <name>${product_fullname} ${product_version}</name>
                    <runInTerminal>0</runInTerminal>
                    <windowsExec>${installdir}/dash.exe</windowsExec>
                    <windowsExecArgs></windowsExecArgs>
                    <windowsIcon>${installdir}/icons/dash.ico</windowsIcon>
                    <windowsPath>${installdir}/</windowsPath>
                </startMenuShortcut>
                <startMenuFolder>
                    <name>Documentation</name>
                    <platforms>windows</platforms>
                    <startMenuShortcutList>
                        <startMenuFileShortcut>
                            <comment>View the DASH documentation</comment>
                            <filePath>${installdir}\Documentation\manual\output\portable_html\TOC.html</filePath>
                            <name>DASH Documentation</name>
                            <runInTerminal>0</runInTerminal>
                            <windowsIcon></windowsIcon>
                        </startMenuFileShortcut>
                        <startMenuFileShortcut>
                            <comment>View the DASH Release Notes</comment>
                            <filePath>${installdir}\Release-Notes.txt</filePath>
                            <name>DASH Release Notes</name>
                            <runInTerminal>0</runInTerminal>
                            <windowsIcon></windowsIcon>
                        </startMenuFileShortcut>
                    </startMenuShortcutList>
                </startMenuFolder>
            </startMenuShortcutList>
        </component>
        <component>
            <name>vcredist</name>
            <description>Visual C runtime</description>
            <canBeEdited>1</canBeEdited>
            <detailedDescription>Microsoft Visual C++ run-time files and operating system components that are required by most projects created with Visual C++</detailedDescription>
            <selected>1</selected>
            <show>1</show>
            <folderList>
                <folder>
                    <description>New Folder</description>
                    <destination>${installdir}</destination>
                    <name>vcfiles</name>
                    <platforms>all</platforms>
                    <distributionFileList>
                        <distributionFile>
                            <origin>../../../../x_mirror/buildman/tools/vcredist/vcredist_x86.exe</origin>
                        </distributionFile>
                    </distributionFileList>
                </folder>
            </folderList>
            <initializationActionList>
                <componentSelection>
                    <deselect>vcredist</deselect>
                    <ruleEvaluationLogic>or</ruleEvaluationLogic>
                    <select></select>
                    <ruleList>
                        <registryTest>
                            <key>HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\DevDiv\VC\Servicing\9.0\RED\1033</key>
                            <logic>exists</logic>
                            <name>Install</name>
                        </registryTest>
                        <registryTest>
                            <key>HKEY_LOCAL_MACHINE\SOFTWARE\Wow6432Node\Microsoft\DevDiv\VC\Servicing\9.0\RED\1033</key>
                            <logic>exists</logic>
                            <name>Install</name>
                        </registryTest>
                    </ruleList>
                </componentSelection>
            </initializationActionList>
            <shouldPackRuleList>
                <platformTest>
                    <type>windows</type>
                </platformTest>
            </shouldPackRuleList>
        </component>
    </componentList>
    <customLanguageFileList>
        <language>
            <code>en</code>
            <file>installer_generated.lng</file>
        </language>
    </customLanguageFileList>
    <finalPageActionList>
        <launchBrowser>
            <progressText>View DASH 3.2 release notes</progressText>
            <run>0</run>
            <url>http://www.ccdc.cam.ac.uk/support/documentation/dash/release_notes/dash-3-2-release-notes.txt</url>
        </launchBrowser>
        <actionGroup>
            <progressText>Launch DASH</progressText>
            <actionList>
                <runProgram>
                    <program>${installdir}/DASH.exe</program>
                    <programArguments></programArguments>
                    <progressText>Launch DASH</progressText>
                    <workingDirectory>${installdir}</workingDirectory>
                    <ruleList>
                        <platformTest>
                            <type>windows</type>
                        </platformTest>
                    </ruleList>
                </runProgram>
            </actionList>
        </actionGroup>
        <showText>
            <progressText>View instructions on how to use more recent DICVOL versions with DASH</progressText>
            <run>0</run>
            <text>DASH is supplied with  DICVOL91 for powder diffraction indexing, but newer versions of this
software are available (such as DICVOL06). We are not, however, able to integrate these into
DASH, but they can be configured to be used by DASH by the end user. In order to so, 
please follow these instructions:

1) Locate the latest copy of DICVOL from the CPP14 website - see

http://www.ccp14.ac.uk/solution/indexing/index.html

2) Download and install the DICVOL program to a location of your choice on your computer. 
DICVOL is usually supplied as a .zip file, you will need to unpack the contents of these files to
a folder on your computer.

3) Run DASH and select the Options -&gt; Configuration option from the pull down menu.

4) Click the "Browse" button next to the DICVOL line and navigate to the DICVOL executable you
saved earlier. Click close to save this setting. 

5) DICVOL should now be configured for use with DASH. When indexing a powder pattern,
select the "External DICVOL" option to use the version of DICVOL you have installed.
</text>
            <title>How to use more recent DICVOL programs with DASH</title>
        </showText>
    </finalPageActionList>
    <parameterList>
        <directoryParameter>
            <name>installdir</name>
            <description>Installer.Parameter.installdir.description</description>
            <explanation>Installer.Parameter.installdir.explanation</explanation>
            <value></value>
            <default>${platform_install_prefix}/${product_shortname}-${product_version}</default>
            <allowEmptyValue>0</allowEmptyValue>
            <ask>yes</ask>
            <cliOptionName>prefix</cliOptionName>
            <mustBeWritable>yes</mustBeWritable>
            <mustExist>0</mustExist>
            <width>40</width>
            <preShowPageActionList>
                <setInstallerVariable>
                    <name>installdir</name>
                    <value>${platform_install_prefix}/CCDC/DASH 3.2</value>
                </setInstallerVariable>
            </preShowPageActionList>
        </directoryParameter>
    </parameterList>
</project>

